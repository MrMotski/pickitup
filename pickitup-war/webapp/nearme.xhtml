<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:s="http://jboss.com/products/seam/taglib"
	template="/layout/template.xhtml">
	<ui:param name="currentPage" value="nearme" />
	<ui:param name="includeGoogleMaps" value="true" />

	<ui:define name="content">
		<div class="container">

			 <!-- Main component for a primary marketing message or call to action -->
		      <div class="col-lg-3"></div>
		      <div class="col-lg-6 well" style="opacity: 0.9;">
		        <h1 style="text-align: center">Near Me</h1>
		        <div class="row">
		            <div class="col-lg-12" id="map-canvas" style="height: 300px;"></div>
		        </div>
		        <br/>
		        <a:form>
		        <a:repeat var="game" value="#{GameHandler.games}" rowKeyVar="index">
		        	<ui:param name="alreadyJoined" value="#{ game.players.contains(player) ? true : false }"></ui:param>
		        	<div class="row">
			            <div class="col-lg-12 well">
			                <h5>
			                    <span class="badge" style="background-color: #AE4D4D; color: #000">#{GamesNearMe.getGlyph(index)}</span> #{game.name}<div class="pull-right">Posted By: <a href="#">#{game.creator.firstname} #{game.creator.lastname}</a></div>
			                </h5>
			                Comments: #{game.description}
			                <br/>
			                <span style="font-weight: 600;">Date:</span> #{GamesNearMe.formatGameDate(game.startDate)}
			                <br/><br/>
			                <div class="game-buttons">
				                <a class="btn btn-sm btn-primary btn-join" style="#{alreadyJoined ? 'display:none;' : ''}" role="button" onclick="joinGame(#{game.id})">Join &#187;</a>
				                <a class="btn btn-sm btn-danger btn-leave" style="#{alreadyJoined ? '' : 'display:none;'}" role="button" onclick="leaveGame(#{game.id})" >Leave &#187;</a>
			                </div>
			            </div>
			        </div>
		        </a:repeat>
		        </a:form>
		      </div>
		      <div class="col-lg-3"></div>
		</div>
		<!-- /container -->
	</ui:define>
	<ui:define name="pageJs">
		<a:jsFunction name="joinGame" action="#{GamesNearMe.joinGame(gameId)}" >
			<a:actionparam name="param1" assignTo="#{gameId}"/>
		</a:jsFunction>
		<a:jsFunction name="leaveGame" action="#{GamesNearMe.leaveGame(gameId)}" >
			<a:actionparam name="param1" assignTo="#{gameId}"/>
		</a:jsFunction>
	    <script>
	        $(function(){
	            nearMeMaps('#{GamesNearMe.locations}');

	            $('.btn-join').click(function(e){
		            $(this).parent().find('.btn-leave').show();
		            $(this).hide();
	            });
	            $('.btn-leave').click(function(e){
		            $(this).parent().find('.btn-join').show();
		            $(this).hide();
	            });
	        });
	    </script>
	</ui:define>
</ui:composition>
